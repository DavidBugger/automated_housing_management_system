{% load static %} {% include "base/base.html" %}

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<!-- Bootstrap CSS -->
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
  rel="stylesheet"
/>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
<!-- SweetAlert CSS and JS -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
<body class="tt-magic-cursor">
  <!-- Preloader Start -->
  <div class="preloader">
    <div class="loading-container">
      <div class="loading"></div>
      <div id="loading-icon">
        <img src="{% static 'images/loader.svg' %}" alt="" />
      </div>
    </div>
  </div>
  <!-- Preloader End -->

  <!-- Magic Cursor Start -->
  <div id="magic-cursor">
    <div id="ball"></div>
  </div>
  <!-- Magic Cursor End -->

  {% include 'components/nav.html' %}

  <!-- Page Header Section Start -->
  <div class="page-header parallaxie">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <!-- Subpage Header Box Start -->
          <div class="page-header-box">
            <h1 class="text-anime">{{property_listing.property_name}}</h1>
            <nav class="wow fadeInUp" data-wow-delay="0.25s">
              <ol class="breadcrumb">
                <li class="breadcrumb-item">
                  <a href="{% url 'main' %}">Home</a>
                </li>
                {% comment %}
                <li class="breadcrumb-item"><a href="#">Listing</a></li>
                {% endcomment %} {% comment %}
                <li class="breadcrumb-item active" aria-current="page">
                  {{property_listing.property_name}}
                </li>
                {% endcomment %}
              </ol>
            </nav>
          </div>
          <!-- Subpage Header Box End -->
        </div>
      </div>
    </div>
  </div>
  <!-- Page Header Section End -->

  <!-- Property Single Page Start -->
  <div class="page-property-single">
    <div class="container">
      <div class="row">
        <div class="col-lg-8">
          <!-- Property Single Content Start -->
          <div class="property-single-content">
            <!-- Property Photos Slider Start -->
            <div
              class="property-photos-slider wow fadeInUp"
              data-wow-delay="0.25s"
            >
              <div class="swiper">
                <div class="swiper-wrapper">
                  <!-- Property Photo Slide Start -->
                  <div class="swiper-slide">
                    <div class="property-photo-item">
                      <figure class="image-anime">
                        <img
                          src="{{property_listing.property_photo.url}}"
                          alt=""
                        />
                      </figure>
                    </div>
                  </div>
                  <!-- Property Photo Slide End -->

                  <!-- Property Photo Slide Start -->
                  <div class="swiper-slide">
                    <div class="property-photo-item">
                      <figure class="image-anime">
                        <img
                          src="{{property_listing.property_photo.url}}"
                          alt=""
                        />
                      </figure>
                    </div>
                  </div>
                  <!-- Property Photo Slide End -->

                  <!-- Property Photo Slide Start -->
                  <div class="swiper-slide">
                    <div class="property-photo-item">
                      <figure class="image-anime">
                        <img
                          src="{{property_listing.property_photo.url}}"
                          alt=""
                        />
                      </figure>
                    </div>
                  </div>
                  <!-- Property Photo Slide End -->

                  <!-- Property Photo Slide Start -->
                  <div class="swiper-slide">
                    <div class="property-photo-item">
                      <figure class="image-anime">
                        <img
                          src="{{property_listing.property_photo.url}}"
                          alt=""
                        />
                      </figure>
                    </div>
                  </div>
                  <!-- Property Photo Slide End -->

                  <!-- Property Photo Slide Start -->
                  <div class="swiper-slide">
                    <div class="property-photo-item">
                      <figure class="image-anime">
                        <img
                          src="{{property_listing.property_photo.url}}"
                          alt=""
                        />
                      </figure>
                    </div>
                  </div>
                  <!-- Property Photo Slide End -->

                  <!-- Property Photo Slide Start -->
                  <div class="swiper-slide">
                    <div class="property-photo-item">
                      <figure class="image-anime">
                        <img
                          src="{{property_listing.property_photo.url}}"
                          alt=""
                        />
                      </figure>
                    </div>
                  </div>
                  <!-- Property Photo Slide End -->
                </div>

                <!-- If we need navigation buttons -->
                <div class="swiper-arrow-prev">
                  <i class="fa-solid fa-arrow-left"></i>
                </div>
                <div class="swiper-arrow-next">
                  <i class="fa-solid fa-arrow-right"></i>
                </div>
              </div>
            </div>
            <!-- Property Photos Slider End -->

            <!-- Property Overview Start -->
            <div class="property-overview wow fadeInUp" data-wow-delay="0.5s">
              <div class="property-single-subtitle">
                <h3>Overview</h3>
              </div>

              <div class="property-overview-box">
                <!-- Property Overview Item Start -->
                <div class="property-overview-item">
                  <div class="icon-box">
                    <img src="{% static 'images/icon-bedrooms.svg' %}" alt="" />
                  </div>

                  <div class="property-overview-content">
                    <h3>Bedrooms</h3>
                    <p>{{property_listing.bedroom}}</p>
                  </div>
                </div>
                <!-- Property Overview Item End -->

                <!-- Property Overview Item Start -->
                <div class="property-overview-item">
                  <div class="icon-box">
                    <img
                      src="{% static 'images/icon-bathrooms.svg' %}"
                      alt=""
                    />
                  </div>

                  <div class="property-overview-content">
                    <h3>Bathrooms</h3>
                    <p>{{property_listing.bathroom}}</p>
                    <p></p>
                  </div>
                </div>
                <!-- Property Overview Item End -->

                <!-- Property Overview Item Start -->
                <div class="property-overview-item">
                  <div class="icon-box">
                    <img src="{% static 'images/icon-areas.svg' %}" alt="" />
                  </div>

                  <div class="property-overview-content">
                    <h3>Area</h3>
                    <p>{{property_listing.area}}</p>
                  </div>
                </div>
                <!-- Property Overview Item End -->

                <!-- Property Overview Item Start -->
                <div class="property-overview-item">
                  <div class="icon-box">
                    <img src="{% static 'images/icon-garages.svg' %}" alt="" />
                  </div>

                  <div class="property-overview-content">
                    <h3>Garages</h3>
                    <p>{{property_listing.garages}}</p>
                  </div>
                </div>
                <!-- Property Overview Item End -->

                <!-- Property Overview Item Start -->
                <div class="property-overview-item">
                  <div class="icon-box">
                    <img
                      src="{% static 'images/icon-built-year.svg' %}"
                      alt=""
                    />
                  </div>

                  <div class="property-overview-content">
                    <h3>Year Built</h3>
                    <p>{{property_listing.year_built}}</p>
                  </div>
                </div>
                <!-- Property Overview Item End -->

                <!-- Property Overview Item Start -->
                <div class="property-overview-item">
                  <div class="icon-box">
                    <img
                      src="{% static 'images/icon-plot-size.svg' %}"
                      alt=""
                    />
                  </div>

                  <div class="property-overview-content">
                    <h3>Plot Size</h3>
                    <p>1.963 sq ft</p>
                  </div>
                </div>
                <!-- Property Overview Item End -->
              </div>
            </div>
            <!-- Property Overview End -->

            <!-- About Property Start -->
            <div class="about-property wow fadeInUp" data-wow-delay="0.75s">
              <div class="property-single-subtitle">
                <h3>About This Property</h3>
              </div>

              <div class="about-property-content">
                <p class="text-justify">{{property_listing.description}}</p>

                <div class="about-property-cta">
                  <a href="#" class="btn-default btn-border">Contact us</a>
                  <a href="{% url 'generate_contract' property_listing.id %}" class="btn-default btn-border">Generate Smart Contract</a>
                  <a
                    href="#"
                    class="btn-default btn-border"
                    data-bs-toggle="modal"
                    data-bs-target="#negotiateModal"
                    >Negotiate</a
                  >
                  <a href="#" class="btn-default"
                    ><i class="fa-solid fa-phone-volume"></i
                    >{{property_listing.seller.phone_number}}
                  </a>
                </div>
              </div>
            </div>
            <!-- About Property End -->

            <!-- Property Amenities Start -->
            <div class="property-amenities wow fadeInUp" data-wow-delay="1s">
              <div class="property-single-subtitle">
                <h3>Features & Amenities</h3>
              </div>

              <div class="property-amenities-box">
                <ul>
                  <li>Club House</li>
                  <li>Barbeque</li>
                  <li>Library</li>
                  <li>Gym</li>
                  <li>Party Lawn</li>
                  <li>Theater</li>
                  <li>Swimming Pool</li>
                  <li>Garden</li>
                  <li>Kids Play Area</li>
                </ul>
              </div>
            </div>
            <!-- Property Amenities End -->

            <!-- Property Map Start -->
            <div
              class="property-map-location wow fadeInUp"
              data-wow-delay="1.25s"
            >
              <div class="property-single-subtitle">
                <h3>Map Location</h3>
              </div>

              <div class="property-map-iframe">
                <iframe
                  src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d49359.77289774349!2d77.59174385159328!3d13.045949738664566!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3bae1670c9b44e6d%3A0xf8dfc3e8517e4fe0!2sBengaluru%2C%20Karnataka!5e0!3m2!1sen!2sin!4v1707476041972!5m2!1sen!2sin"
                  width="600"
                  height="450"
                  style="border: 0"
                  allowfullscreen=""
                  loading="lazy"
                  referrerpolicy="no-referrer-when-downgrade"
                ></iframe>
              </div>
            </div>
            <!-- Property Map End -->
          </div>
          <!-- Property Single Content End -->
        </div>

        <div class="col-lg-4">
          <!-- Property Single Sidebar Start -->
          <div class="porperty-single-sidebar">
            <!-- Property Information Box Start -->
            <div class="property-info-box wow fadeInUp" data-wow-delay="0.25s">
              <h3>Other Details</h3>

              <div class="property-info-lists">
                <!-- Property Info item Start-->
                <div class="property-info-item">
                  <div class="icon-box">
                    <img
                      src="{% static 'images/icon-property-location.svg' %}"
                      alt=""
                    />
                  </div>

                  <p>{{property_listing.seller.location}}</p>
                </div>
                <!-- Property Info item End-->

                <!-- Property Info item Start-->
                <div class="property-info-item">
                  <div class="icon-box">
                    <img
                      src="{% static 'images/icon-property-phone.svg' %}"
                      alt=""
                    />
                  </div>

                  <p>{{property_listing.seller.phone_number}}</p>
                </div>
                <!-- Property Info item End-->

                <!-- Property Info item Start-->
                <div class="property-info-item">
                  <div class="icon-box">
                    <img
                      src="{% static 'images/icon-property-price.svg' %}"
                      alt=""
                    />
                  </div>

                  <p>{{property_listing.price}}</p>
                </div>
                <!-- Property Info item End-->
              </div>
            </div>
            <!-- Property Information Box End -->

            <!-- Negotiate Modal -->
            

            <!-- Property Inquiry Form Start -->
            <div
              class="property-inquiry-box wow fadeInUp"
              data-wow-delay="0.5s"
            >
              <h3>Send Inquiry</h3>

              <div class="property-inquiry-form">
                <!-- Toast Container -->

                <form
                  id="inquiryForm"
                  data-id="{{ property_listing.id }}"
                  method="POST"
                >
                  {% csrf_token %}
                  <div class="row">
                    <div class="form-group col-md-12 mb-3">{{ form.as_p }}</div>
                    <div class="col-md-12 text-center">
                      <button type="submit" class="btn-default">
                        Send Message
                      </button>
                    </div>
                  </div>
                </form>

                <!-- Toast Container -->
                <div
                  aria-live="polite"
                  aria-atomic="true"
                  class="position-fixed top-0 end-0 p-3"
                  style="z-index: 1050"
                >
                  <div id="toastContainer"></div>
                </div>
              </div>
            </div>
            <!-- Property Inquiry Form End -->
          </div>
          <!-- Property Single Sidebar End -->
        </div>
      </div>
    </div>
  </div>

  <div
  class="modal fade"
  id="negotiateModal"
  tabindex="-1"
  aria-labelledby="negotiateModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="negotiateModalLabel">Negotiate</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form
          id="negotiationForm"
          method="POST"
          data-property-id="{{ property_listing.id }}"
        >
          {% csrf_token %}
          {% if not user.is_authenticated %}
          <div class="mb-3">
            <label for="guest_name" class="form-label">Your Name</label>
            <input
              type="text"
              name="guest_name"
              id="guest_name"
              class="form-control"
              required
            />
          </div>
          <div class="mb-3">
            <label for="guest_email" class="form-label">Your Email</label>
            <input
              type="email"
              name="guest_email"
              id="guest_email"
              class="form-control"
              required
            />
          </div>
          <div class="mb-3">
            <label for="guest_amount" class="form-label">Proposed Amount</label>
            <input
              type="number"
              name="guest_amount"
              id="guest_amount"
              class="form-control"
              required
            />
          </div>
          <div class="mb-3">
            <label for="guest_phone" class="form-label">Your Phone</label>
            <input
              type="text"
              name="guest_phone"
              id="guest_phone"
              class="form-control"
              required
            />
          </div>
          {% endif %}
          <div class="mb-3">
            <label for="message" class="form-label">Message</label>
            <textarea
              name="message"
              id="message"
              class="form-control"
              rows="4"
              placeholder="Enter your message"
              required
            ></textarea>
          </div>
          <button type="submit" class="btn btn-primary">Send Message</button>
        </form>
      </div>
    </div>
  </div>
</div>
  <!-- Property Sinlge Page End -->
  <script>
    $(document).ready(function () {
      $("#inquiryForm").on("submit", function (e) {
        e.preventDefault(); // Prevent the default form submission

        const form = $(this);
        const propertyId = form.data("id");
        const url = `/property_listing/${propertyId}/submit_inquiry/`; // Endpoint for submission
        const formData = form.serialize(); // Serialize form data

        // Change button text and add loader
        const submitButton = form.find("button[type='submit']");
        submitButton.html(
          '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Please wait...'
        );
        submitButton.prop("disabled", true);

        $.ajax({
          url: url,
          type: "POST",
          data: formData,
          success: function (response) {
            // Show success alert
            Swal.fire({
              icon: "success",
              title: "Success",
              text: response.message,
              timer: 2000,
              showConfirmButton: false,
            });

            // Redirect after 2 seconds
            setTimeout(function () {
              window.location.href = response.redirect_url;
            }, 2000);
          },
          error: function (xhr) {
            const response = xhr.responseJSON;

            // Show error alert
            Swal.fire({
              icon: "error",
              title: "Error",
              text: response.message,
            });

            // Optionally, log form errors
            if (response.errors) {
              console.error("Form errors:", response.errors);
            }
          },
        });
      });
    });
  </script>

  <script>
    $(document).ready(function () {
        $("#negotiationForm").on("submit", function (e) {
            e.preventDefault(); // Prevent the default form submission

            const form = $(this);
            const propertyId = form.data("property-id");
            const url = `/property_listing/${propertyId}/submit_negotiation/`; 
            const formData = form.serialize(); // Serialize form data
            // Change button text and add loader
            const submitButton = form.find("button[type='submit']");
            submitButton.html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Please wait...');
            submitButton.prop("disabled", true);

            $.ajax({
                url: url,
                type: "POST",
                data: formData,
                success: function (response) {
                    // Show success alert
                    Swal.fire({
                      icon: "success",
                      title: "Success",
                      text: response.message,
                      timer: 2000,
                      showConfirmButton: false,
                  }).then(() => {
                      // Reload the page after the timer
                      location.reload();
                  });
                    // Close the modal after success
                    $("#negotiateModal").modal("hide");
                    // Reset the form
                    form[0].reset();
                    // Reset the button
                    submitButton.html("Send Message");
                    submitButton.prop("disabled", false);
                },
                error: function (xhr) {
                    const response = xhr.responseJSON;

                    // Show error alert
                    Swal.fire({
                        icon: "error",
                        title: "Error",
                        text: response.message,
                    });

                    // Reset the button
                    submitButton.html("Send Message");
                    submitButton.prop("disabled", false);

                    // Optionally, log form errors
                    if (response.errors) {
                        console.error("Form errors:", response.errors);
                    }
                },
            });
        });
    });
</script>

  {% include "components/footer.html"%}
</body>
